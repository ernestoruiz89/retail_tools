{#
  POS Closing Report - Print Format for Thermal Printers (80mm)
  Retail Tools App
#}

<style>
  /* Base styles for thermal printer 80mm */
  .pos-closing-report {
    font-family: 'Courier New', monospace;
    font-size: 12px;
    width: 100%;
    max-width: 280px;
    margin: 0 auto;
    padding: 5px;
    color: #000;
    background: #fff;
  }

  .pos-closing-report * {
    box-sizing: border-box;
  }

  /* Header */
  .pcr-header {
    text-align: center;
    border-bottom: 1px dashed #000;
    padding-bottom: 8px;
    margin-bottom: 8px;
  }

  .pcr-company {
    font-size: 14px;
    font-weight: bold;
    text-transform: uppercase;
    margin-bottom: 4px;
  }

  .pcr-title {
    font-size: 16px;
    font-weight: bold;
    letter-spacing: 2px;
    margin: 8px 0;
  }

  .pcr-meta {
    font-size: 11px;
    line-height: 1.4;
  }

  /* Sections */
  .pcr-section {
    margin: 10px 0;
    padding-bottom: 8px;
    border-bottom: 1px dashed #000;
  }

  .pcr-section:last-child {
    border-bottom: none;
  }

  .pcr-section-title {
    font-weight: bold;
    text-transform: uppercase;
    font-size: 11px;
    margin-bottom: 6px;
    text-align: center;
    letter-spacing: 1px;
  }

  /* Summary */
  .pcr-summary-row {
    display: flex;
    justify-content: space-between;
    margin: 3px 0;
    font-size: 11px;
  }

  .pcr-summary-row.total {
    font-weight: bold;
    font-size: 13px;
    margin-top: 6px;
    padding-top: 4px;
    border-top: 1px solid #000;
  }

  /* Payment table */
  .pcr-payment-table {
    width: 100%;
    font-size: 10px;
    border-collapse: collapse;
  }

  .pcr-payment-table th {
    text-align: left;
    font-weight: bold;
    padding: 2px 1px;
    border-bottom: 1px solid #000;
    font-size: 9px;
  }

  .pcr-payment-table td {
    padding: 3px 1px;
    vertical-align: top;
  }

  .pcr-payment-table .amount {
    text-align: right;
    font-family: 'Courier New', monospace;
  }

  .pcr-payment-table .diff-positive {
    color: #008000;
  }

  .pcr-payment-table .diff-negative {
    color: #cc0000;
    font-weight: bold;
  }

  /* Transactions */
  .pcr-transaction {
    display: flex;
    justify-content: space-between;
    font-size: 10px;
    padding: 2px 0;
    border-bottom: 1px dotted #ccc;
  }

  .pcr-transaction:last-child {
    border-bottom: none;
  }

  .pcr-transaction .invoice {
    font-weight: bold;
  }

  .pcr-transaction .return-badge {
    background: #000;
    color: #fff;
    padding: 0 3px;
    font-size: 8px;
    margin-left: 4px;
  }

  /* Footer */
  .pcr-footer {
    margin-top: 15px;
    text-align: center;
  }

  .pcr-signature {
    margin-top: 30px;
    padding-top: 5px;
    border-top: 1px solid #000;
    font-size: 10px;
  }

  .pcr-printed-at {
    font-size: 9px;
    color: #666;
    margin-top: 10px;
  }

  /* Print styles */
  @media print {
    .pos-closing-report {
      max-width: none;
      width: 72mm;
    }
  }
</style>

<div class="pos-closing-report">
  <!-- Header -->
  <div class="pcr-header">
    <div class="pcr-company">{{ doc.company }}</div>
    <div class="pcr-title">CIERRE DE CAJA</div>
    <div class="pcr-meta">
      <div><strong>{{ doc.name }}</strong></div>
      <div>POS: {{ doc.pos_profile }}</div>
      <div>Usuario: {{ doc.user }}</div>
      <div style="margin-top: 4px;">
        {{ frappe.format(doc.period_start_date, {'fieldtype': 'Datetime'}) }}
      </div>
      <div>↓</div>
      <div>
        {{ frappe.format(doc.period_end_date, {'fieldtype': 'Datetime'}) }}
      </div>
    </div>
  </div>

  <!-- Sales Summary -->
  <div class="pcr-section">
    <div class="pcr-section-title">Resumen de Ventas</div>
    <div class="pcr-summary-row">
      <span>Transacciones:</span>
      <span>{{ doc.pos_transactions | length }}</span>
    </div>
    <div class="pcr-summary-row">
      <span>Cantidad de Items:</span>
      <span>{{ doc.total_quantity | int }}</span>
    </div>
    <div class="pcr-summary-row">
      <span>Neto:</span>
      <span>{{ frappe.format(doc.net_total, {'fieldtype': 'Currency'}) }}</span>
    </div>
    <div class="pcr-summary-row total">
      <span>TOTAL:</span>
      <span>{{ frappe.format(doc.grand_total, {'fieldtype': 'Currency'}) }}</span>
    </div>
  </div>

  <!-- Payment Breakdown -->
  <div class="pcr-section">
    <div class="pcr-section-title">Métodos de Pago</div>
    <table class="pcr-payment-table">
      <thead>
        <tr>
          <th>Método</th>
          <th class="amount">Apert.</th>
          <th class="amount">Esper.</th>
          <th class="amount">Cierre</th>
          <th class="amount">Dif.</th>
        </tr>
      </thead>
      <tbody>
        {% for payment in doc.payment_reconciliation %}
        <tr>
          <td>{{ payment.mode_of_payment }}</td>
          <td class="amount">{{ frappe.format(payment.opening_amount, {'fieldtype': 'Currency'}) }}</td>
          <td class="amount">{{ frappe.format(payment.expected_amount, {'fieldtype': 'Currency'}) }}</td>
          <td class="amount">{{ frappe.format(payment.closing_amount, {'fieldtype': 'Currency'}) }}</td>
          <td class="amount {% if payment.difference > 0 %}diff-positive{% elif payment.difference < 0 %}diff-negative{% endif %}">
            {{ frappe.format(payment.difference, {'fieldtype': 'Currency'}) }}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Transactions List -->
  <div class="pcr-section">
    <div class="pcr-section-title">Transacciones ({{ doc.pos_transactions | length }})</div>
    {% for txn in doc.pos_transactions %}
    <div class="pcr-transaction">
      <div>
        <span class="invoice">{{ txn.pos_invoice }}</span>
        {% if txn.is_return %}
        <span class="return-badge">DEV</span>
        {% endif %}
        <br>
        <small>{{ txn.customer }} · {{ frappe.format(txn.posting_date, {'fieldtype': 'Date'}) }}</small>
      </div>
      <div class="amount">
        {{ frappe.format(txn.grand_total, {'fieldtype': 'Currency'}) }}
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Footer -->
  <div class="pcr-footer">
    <div class="pcr-signature">
      Firma del Cajero
    </div>
    <div class="pcr-printed-at">
      Impreso: {{ frappe.format(frappe.utils.now(), {'fieldtype': 'Datetime'}) }}
    </div>
  </div>
</div>
